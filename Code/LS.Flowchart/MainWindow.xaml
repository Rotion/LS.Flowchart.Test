<Window
    x:Class="LS.Flowchart.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:LS.Flowchart"
    xmlns:localUc="clr-namespace:LS.Flowchart.UCControls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    xmlns:tb="http://www.hardcodet.net/taskbar"
    xmlns:uc="clr-namespace:LS.WPF.Core.Library;assembly=LS.WPF.Core.Library"
    Title="MainWindow"
    d:Height="1080"
    d:Width="1920"
    AllowsTransparency="True"
    Background="{DynamicResource DefaultBackground}"
    Foreground="{DynamicResource DefaultForeground}"
    ResizeMode="CanResize"
    ShowInTaskbar="True"
    Topmost="True"
    WindowStartupLocation="CenterScreen"
    WindowState="Maximized"
    WindowStyle="None"
    mc:Ignorable="d">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="85" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Grid
            x:Name="winBar"
            Grid.Row="0"
            Background="{DynamicResource WinBarBackground}">
            <Grid.RowDefinitions>
                <RowDefinition Height="5" />
                <RowDefinition />
                <RowDefinition />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="6*" />
            </Grid.ColumnDefinitions>
            <Border
                Grid.Row="0"
                Grid.Column="0"
                Grid.ColumnSpan="2"
                Margin="0,2,0,0"
                BorderBrush="{DynamicResource OrangeBrush}"
                BorderThickness="0,2,0,0" />
            <Image
                Grid.Row="1"
                Grid.RowSpan="2"
                Grid.Column="0"
                Margin="2,0"
                Source="/Asset/Images/logo2.png"
                Stretch="Uniform" />
            <Border
                Grid.Row="1"
                Grid.Column="1"
                BorderBrush="{DynamicResource DefaultGray}"
                BorderThickness="0,0,0,1" />
            <StackPanel
                Grid.Row="1"
                Grid.Column="1"
                Margin="10,5"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Orientation="Horizontal">
                <StackPanel.Resources>
                    <sys:Double x:Key="Button.Size">30</sys:Double>
                    <SolidColorBrush x:Key="Button.Foreground" Color="DarkGray" />
                </StackPanel.Resources>
                <uc:IconSmallButton
                    Width="{StaticResource Button.Size}"
                    Height="{StaticResource Button.Size}"
                    Margin="10,0"
                    Background="Transparent"
                    Command="{Binding OperationCommand}"
                    CommandParameter="Theme"
                    Foreground="{StaticResource Button.Foreground}"
                    IconType="Theme" />
                <uc:IconSmallButton
                    Width="{StaticResource Button.Size}"
                    Height="{StaticResource Button.Size}"
                    Margin="10,0"
                    Background="Transparent"
                    Command="{Binding OperationCommand}"
                    CommandParameter="MinWindow"
                    Foreground="{StaticResource Button.Foreground}"
                    IconType="Min" />
                <uc:IconSmallButton
                    Width="{StaticResource Button.Size}"
                    Height="{StaticResource Button.Size}"
                    Margin="10,0"
                    Background="Transparent"
                    Command="{Binding OperationCommand}"
                    CommandParameter="MaxWindow"
                    Foreground="{StaticResource Button.Foreground}"
                    IconType="Max" />
                <uc:IconSmallButton
                    Width="{StaticResource Button.Size}"
                    Height="{StaticResource Button.Size}"
                    Margin="10,0"
                    Background="Transparent"
                    Command="{Binding OperationCommand}"
                    CommandParameter="CloseWindow"
                    Foreground="{StaticResource Button.Foreground}"
                    IconType="Close" />
            </StackPanel>

            <StackPanel
                Grid.Row="1"
                Grid.Column="1"
                Orientation="Horizontal">
                <Menu
                    Margin="0,2,0,0"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Center"
                    HorizontalContentAlignment="Center"
                    VerticalContentAlignment="Center"
                    Background="Transparent"
                    FontSize="20"
                    Foreground="{DynamicResource DefaultGray}">
                    <MenuItem
                        Margin="10,0,10,0"
                        Header="文件"
                        Style="{DynamicResource Main_Menu}">
                        <MenuItem
                            Header="新建"
                            Icon="{DynamicResource 新建}"
                            Style="{DynamicResource Main_Menu}">
                            <MenuItem Header="方案" Style="{DynamicResource Main_Menu}" />
                            <MenuItem Header="流程" Style="{DynamicResource Main_Menu}" />
                        </MenuItem>
                        <MenuItem
                            Command="{Binding OperationCommand}"
                            CommandParameter="OpenProject"
                            Header="打开"
                            Style="{DynamicResource Main_Menu}" />
                        <MenuItem
                            Command="{Binding OperationCommand}"
                            CommandParameter="SaveProject"
                            Header="保存"
                            Style="{DynamicResource Main_Menu}" />
                        <MenuItem
                            Command="{Binding OperationCommand}"
                            CommandParameter="SaveAs"
                            Header="另存为"
                            Style="{DynamicResource Main_Menu}" />
                        <MenuItem
                            Command="{Binding OperationCommand}"
                            CommandParameter="CloseWindow"
                            Header="退出"
                            Style="{DynamicResource Main_Menu}" />
                    </MenuItem>
                    <MenuItem
                        Margin="10,0,10,0"
                        Header="设置"
                        Style="{DynamicResource Main_Menu}">
                        <MenuItem
                            Command="{Binding OperationCommand}"
                            CommandParameter="SoftSetting"
                            Header="软件设置"
                            Style="{DynamicResource Main_Menu}" />
                        <MenuItem Header="权限设置" Style="{DynamicResource Main_Menu}" />
                    </MenuItem>
                </Menu>
            </StackPanel>
            <StackPanel
                Grid.Row="2"
                Grid.Column="1"
                Orientation="Horizontal">
                <StackPanel.Resources>
                    <sys:Double x:Key="BtnHeight">40</sys:Double>
                    <sys:Double x:Key="BtnWidth">70</sys:Double>
                    <sys:Double x:Key="PathHeight">30</sys:Double>
                    <sys:Double x:Key="PathWidth">30</sys:Double>
                </StackPanel.Resources>
                <!--  流程操作  -->
                <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                    <uc:CommonButton
                        Width="{StaticResource BtnWidth}"
                        Height="{StaticResource BtnHeight}"
                        Background="{DynamicResource DefaultBackground}"
                        Command="{Binding OperationCommand}"
                        CommandParameter="SaveProject"
                        MouseOverBrush="Transparent"
                        PathData="{DynamicResource 保存}"
                        PathFill="{StaticResource DefaultGray}"
                        PathHeight="{StaticResource PathHeight}"
                        PathMouseOverBrush="{StaticResource OrangeBrush}"
                        PathVisibility="Visible"
                        PathWidth="{StaticResource PathWidth}"
                        ToolTip="保存" />
                    <uc:CommonButton
                        Width="{StaticResource BtnWidth}"
                        Height="{StaticResource BtnHeight}"
                        Background="{DynamicResource DefaultBackground}"
                        Command="{Binding OperationCommand}"
                        CommandParameter="OpenProject"
                        MouseOverBrush="Transparent"
                        PathData="{DynamicResource 打开}"
                        PathFill="{StaticResource DefaultGray}"
                        PathHeight="{StaticResource PathHeight}"
                        PathMouseOverBrush="{StaticResource OrangeBrush}"
                        PathVisibility="Visible"
                        PathWidth="{StaticResource PathWidth}"
                        ToolTip="打开文件" />
                    <uc:CommonButton
                        Width="{StaticResource BtnWidth}"
                        Height="{StaticResource BtnHeight}"
                        Background="{DynamicResource DefaultBackground}"
                        MouseOverBrush="Transparent"
                        PathData="{DynamicResource 上一步}"
                        PathFill="{StaticResource DefaultGray}"
                        PathHeight="{StaticResource PathHeight}"
                        PathMouseOverBrush="{StaticResource OrangeBrush}"
                        PathVisibility="Visible"
                        PathWidth="{StaticResource PathWidth}"
                        ToolTip="退回到上一步" />
                    <uc:CommonButton
                        Width="{StaticResource BtnWidth}"
                        Height="{StaticResource BtnHeight}"
                        Background="{DynamicResource DefaultBackground}"
                        MouseOverBrush="Transparent"
                        PathData="{DynamicResource 下一步}"
                        PathFill="{StaticResource DefaultGray}"
                        PathHeight="{StaticResource PathHeight}"
                        PathMouseOverBrush="{StaticResource OrangeBrush}"
                        PathVisibility="Visible"
                        PathWidth="{StaticResource PathWidth}"
                        ToolTip="到下一步" />
                    <uc:CommonButton
                        Width="{StaticResource BtnWidth}"
                        Height="{StaticResource BtnHeight}"
                        Background="{DynamicResource DefaultBackground}"
                        MouseOverBrush="Transparent"
                        PathData="{DynamicResource 文件锁定}"
                        PathFill="{StaticResource DefaultGray}"
                        PathHeight="{StaticResource PathHeight}"
                        PathMouseOverBrush="{StaticResource OrangeBrush}"
                        PathVisibility="Visible"
                        PathWidth="{StaticResource PathWidth}"
                        ToolTip="锁定方案" />
                </StackPanel>
                <!--  硬件模块  -->
                <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                    <Line
                        VerticalAlignment="Center"
                        Stroke="{DynamicResource DefaultGray}"
                        StrokeDashArray="4,2"
                        StrokeThickness="1"
                        X1="0"
                        X2="0"
                        Y1="0"
                        Y2="30" />
                    <uc:CommonButton
                        Width="{StaticResource BtnWidth}"
                        Height="{StaticResource BtnHeight}"
                        Background="{DynamicResource DefaultBackground}"
                        MouseOverBrush="Transparent"
                        PathData="{DynamicResource 相机1}"
                        PathFill="{StaticResource DefaultGray}"
                        PathHeight="{StaticResource PathHeight}"
                        PathMouseOverBrush="{StaticResource OrangeBrush}"
                        PathVisibility="Visible"
                        PathWidth="{StaticResource PathWidth}"
                        ToolTip="相机管理" />
                    <uc:CommonButton
                        Width="{StaticResource BtnWidth}"
                        Height="{StaticResource BtnHeight}"
                        Background="{DynamicResource DefaultBackground}"
                        MouseOverBrush="Transparent"
                        PathData="{DynamicResource 设备管理}"
                        PathFill="{StaticResource DefaultGray}"
                        PathHeight="{StaticResource PathHeight}"
                        PathMouseOverBrush="{StaticResource OrangeBrush}"
                        PathVisibility="Visible"
                        PathWidth="{StaticResource PathWidth}"
                        ToolTip="控制器管理(光源，工控机接口等)" />
                    <uc:CommonButton
                        Width="{StaticResource BtnWidth}"
                        Height="{StaticResource BtnHeight}"
                        Background="{DynamicResource DefaultBackground}"
                        Command="{Binding OperationCommand}"
                        CommandParameter="Communication"
                        MouseOverBrush="Transparent"
                        PathData="{DynamicResource 设备通讯}"
                        PathFill="{StaticResource DefaultGray}"
                        PathHeight="{StaticResource PathHeight}"
                        PathMouseOverBrush="{StaticResource OrangeBrush}"
                        PathVisibility="Visible"
                        PathWidth="{StaticResource PathWidth}"
                        ToolTip="通讯管理(串口、TCP等)" />
                </StackPanel>
                <!--  全局数据  -->
                <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                    <Line
                        VerticalAlignment="Center"
                        Stroke="{DynamicResource DefaultGray}"
                        StrokeDashArray="4,2"
                        StrokeThickness="1"
                        X1="0"
                        X2="0"
                        Y1="0"
                        Y2="30" />
                    <uc:CommonButton
                        Width="{StaticResource BtnWidth}"
                        Height="{StaticResource BtnHeight}"
                        Background="{DynamicResource DefaultBackground}"
                        Command="{Binding OperationCommand}"
                        CommandParameter="GlobalObject"
                        MouseOverBrush="Transparent"
                        PathData="{DynamicResource 全局变量}"
                        PathFill="{StaticResource DefaultGray}"
                        PathHeight="{StaticResource PathHeight}"
                        PathMouseOverBrush="{StaticResource OrangeBrush}"
                        PathVisibility="Visible"
                        PathWidth="{StaticResource PathWidth}"
                        ToolTip="全局变量" />
                    <uc:CommonButton
                        Width="{StaticResource BtnWidth}"
                        Height="{StaticResource BtnHeight}"
                        Background="{DynamicResource DefaultBackground}"
                        MouseOverBrush="Transparent"
                        PathData="{DynamicResource 触发}"
                        PathFill="{StaticResource DefaultGray}"
                        PathHeight="{StaticResource PathHeight}"
                        PathMouseOverBrush="{StaticResource OrangeBrush}"
                        PathVisibility="Visible"
                        PathWidth="{StaticResource PathWidth}"
                        ToolTip="全局触发" />
                    <uc:CommonButton
                        Width="{StaticResource BtnWidth}"
                        Height="{StaticResource BtnHeight}"
                        Background="{DynamicResource DefaultBackground}"
                        MouseOverBrush="Transparent"
                        PathData="{DynamicResource 连接管理}"
                        PathFill="{StaticResource DefaultGray}"
                        PathHeight="{StaticResource PathHeight}"
                        PathMouseOverBrush="{StaticResource OrangeBrush}"
                        PathVisibility="Visible"
                        PathWidth="{StaticResource PathWidth}"
                        ToolTip="连接管理" />
                    <uc:CommonButton
                        Width="{StaticResource BtnWidth}"
                        Height="{StaticResource BtnHeight}"
                        Background="{DynamicResource DefaultBackground}"
                        MouseOverBrush="Transparent"
                        PathData="{DynamicResource 脚本}"
                        PathFill="{StaticResource DefaultGray}"
                        PathHeight="{StaticResource PathHeight}"
                        PathMouseOverBrush="{StaticResource OrangeBrush}"
                        PathVisibility="Visible"
                        PathWidth="{StaticResource PathWidth}"
                        ToolTip="脚本" />
                </StackPanel>
                <!--  流程执行  -->
                <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                    <Line
                        VerticalAlignment="Center"
                        Stroke="{DynamicResource DefaultGray}"
                        StrokeDashArray="4,2"
                        StrokeThickness="1"
                        X1="0"
                        X2="0"
                        Y1="0"
                        Y2="30" />
                    <uc:CommonButton
                        Width="{StaticResource BtnWidth}"
                        Height="{StaticResource BtnHeight}"
                        Background="{DynamicResource DefaultBackground}"
                        MouseOverBrush="Transparent"
                        PathData="{DynamicResource 运行一次}"
                        PathFill="{StaticResource DefaultGray}"
                        PathHeight="{StaticResource PathHeight}"
                        PathMouseOverBrush="{StaticResource OrangeBrush}"
                        PathVisibility="Visible"
                        PathWidth="{StaticResource PathWidth}"
                        ToolTip="运行一次" />
                    <uc:CommonButton
                        Width="{StaticResource BtnWidth}"
                        Height="{StaticResource BtnHeight}"
                        Background="{DynamicResource DefaultBackground}"
                        MouseOverBrush="Transparent"
                        PathData="{DynamicResource 循环执行}"
                        PathFill="{StaticResource DefaultGray}"
                        PathHeight="{StaticResource PathHeight}"
                        PathMouseOverBrush="{StaticResource OrangeBrush}"
                        PathVisibility="Visible"
                        PathWidth="{StaticResource PathWidth}"
                        ToolTip="循环执行" />
                    <uc:CommonButton
                        Width="{StaticResource BtnWidth}"
                        Height="{StaticResource BtnHeight}"
                        Background="{DynamicResource DefaultBackground}"
                        MouseOverBrush="Transparent"
                        PathData="{DynamicResource 运行窗口}"
                        PathFill="{StaticResource DefaultGray}"
                        PathHeight="{StaticResource PathHeight}"
                        PathMouseOverBrush="{StaticResource OrangeBrush}"
                        PathVisibility="Visible"
                        PathWidth="{StaticResource PathWidth}"
                        ToolTip="运行界面" />

                </StackPanel>
            </StackPanel>

            <Grid.InputBindings>
                <MouseBinding
                    Command="{Binding OperationCommand}"
                    CommandParameter="MaxWindow"
                    MouseAction="LeftDoubleClick" />
            </Grid.InputBindings>
        </Grid>
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <Grid Grid.Column="0">
                <Grid.Resources>
                    <sys:Double x:Key="BtnHeight">50</sys:Double>
                    <sys:Double x:Key="BtnWidth">50</sys:Double>
                    <sys:Double x:Key="PathHeight">30</sys:Double>
                    <sys:Double x:Key="PathWidth">30</sys:Double>
                </Grid.Resources>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="30" />
                </Grid.RowDefinitions>

                <localUc:ToolsControl
                    MinHeight="600"
                    IsExpanded="{Binding Tool_IsExpanded, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    ItemSource="{Binding ToolItems, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    SelectModule="{Binding ModuleItem, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                <Button
                    Grid.Row="1"
                    Margin="0,0,0,5"
                    Command="{Binding ToolOpCommand}"
                    CommandParameter="ToolExpandClick">
                    <Button.Template>
                        <ControlTemplate>
                            <Grid Background="{DynamicResource DefaultBackground}">
                                <Path
                                    x:Name="_btn_path"
                                    Width="20"
                                    Height="20"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                                    Data="{DynamicResource 向左}"
                                    Fill="{DynamicResource DefaultForeground}"
                                    Stretch="Fill" />
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="_btn_path" Property="Fill" Value="{DynamicResource OrangeBrush}" />
                                </Trigger>
                                <DataTrigger Binding="{Binding Tool_IsExpanded, UpdateSourceTrigger=PropertyChanged}" Value="True">
                                    <Setter TargetName="_btn_path" Property="Data" Value="{DynamicResource 向右}" />
                                </DataTrigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </Grid>

            <Grid Grid.Column="1">
                <TabControl
                    x:Name="canvasTab"
                    FontSize="25"
                    SelectedIndex="{Binding TabIndex, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    SelectedItem="{Binding TabSelectItem, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    Style="{DynamicResource NoBorderTabControl}" />
                <!--<Canvas
                  x:Name="_canvas"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Stretch"
                  Background="{DynamicResource DefaultCanvasBackground}"
                  ScrollViewer.HorizontalScrollBarVisibility="Visible"
                  ScrollViewer.VerticalScrollBarVisibility="Visible">
                  <TextBlock
                      HorizontalAlignment="Right"
                      VerticalAlignment="Top"
                      FontSize="16"
                      Foreground="Black"
                      Text="{Binding PointString, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                      TextAlignment="Center" />
              </Canvas>-->
            </Grid>
        </Grid>


        <!--  核心：WPF托盘图标控件 TrayIcon  -->
        <!--  图标是否显示在托盘  -->
        <!--  鼠标悬停提示文本  -->
        <tb:TaskbarIcon
            x:Name="WpfTrayIcon"
            IconSource="pack://application:,,,/Asset/Images/logo.ico"
            ToolTipText="PCZD主站程序"
            Visibility="Visible">
            <!--  托盘图标文件（需提前添加）  -->
            <!--  托盘图标右键上下文菜单  -->
            <tb:TaskbarIcon.ContextMenu>
                <ContextMenu>
                    <MenuItem
                        Command="{Binding NotifyIconCommand}"
                        CommandParameter="ShowWindows"
                        Header="显示主窗口" />
                    <Separator />
                    <!--  分隔线  -->
                    <MenuItem
                        Command="{Binding NotifyIconCommand}"
                        CommandParameter="Exit"
                        Foreground="#FFE53935"
                        Header="退出程序" />
                </ContextMenu>
            </tb:TaskbarIcon.ContextMenu>
        </tb:TaskbarIcon>
    </Grid>
</Window>
